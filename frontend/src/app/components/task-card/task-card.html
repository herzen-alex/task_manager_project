<div class="task-card" [class.done]="task.done" [ngClass]="task.priority">

  <!-- Ñ‚ĞµĞ¿ĞµÑ€ÑŒ ÑˆĞ°Ğ¿ĞºĞ° â€” handle Ğ´Ğ»Ñ dnd -->
  <div class="task-header" cdkDragHandle>
    <div class="task-title-row">
      <h3>{{ task.title }}</h3>

      <span class="priority-badge" [ngClass]="task.priority">
        {{ task.priority === 'low' ? 'Low' : task.priority === 'medium' ? 'Medium' : 'Urgent' }}
      </span>
    </div>

    <div class="task-meta">
      <small>ğŸ•’ Created: {{ task.createdAt | date:'dd/MM/yyyy' }}</small>
      <small *ngIf="task.dueDate">â° Due: {{ task.dueDate | date:'dd/MM/yyyy' }}</small>
    </div>
  </div>

  <p class="task-desc">{{ task.description }}</p>

  <!-- ğŸ“Š Progress -->
  <div *ngIf="task.subTasks?.length" class="progress-wrapper">
    <small>Progress: {{ progress }}%</small>
    <progress [value]="progress" max="100"></progress>
  </div>

  <!-- âœ… Subtasks -->
  <ul *ngIf="task.subTasks?.length" class="subtask-list" [class.locked]="task.done">
    <li *ngFor="let sub of task.subTasks; let i = index">
      <input type="checkbox" [(ngModel)]="sub.done" (change)="updateProgress()" [disabled]="task.done" />
      <span [class.done]="sub.done">{{ sub.title }}</span>

      <button class="delete-subtask" (click)="deleteSubTask(i)" [disabled]="task.done" title="Delete subtask">
        âœ–
      </button>
    </li>
  </ul>

  <!-- ğŸ‘¥ Assignees (stacked avatars) -->
  <div class="task-assignees" *ngIf="assigneeChips.length">
    <div class="avatar-group stacked">
      <div class="avatar" *ngFor="let chip of assigneeChips | slice:0:5; let i = index"
        [style.background-color]="chip.color" [title]="chip.initials">
        {{ chip.initials }}
      </div>
      <div class="avatar more-avatar" *ngIf="assigneeChips.length > 5" [title]="'+' + (assigneeChips.length - 5)">
        +{{ assigneeChips.length - 5 }}
      </div>
    </div>
  </div>

  <!-- ğŸ”˜ Actions -->
  <div class="actions">
    <div class="done-wrapper">
      <button (click)="toggleDone.emit(task)" [disabled]="!canMarkDone">
        {{ task.done ? 'Undo' : 'Done' }}
      </button>

      <div class="tooltip" *ngIf="!canMarkDone" role="tooltip" aria-live="polite">
        Complete all subtasks first
      </div>
    </div>

    <div class="icon-actions">
      <button type="button" class="icon-btn" (click)="openEdit()" title="Edit task" [disabled]="task.done">
        âœï¸
      </button>

      <button type="button" class="icon-btn danger" (click)="delete.emit(task)" title="Delete task">
        ğŸ—‘
      </button>
    </div>
  </div>

  <!-- âœ¨ Modal Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ -->
  <app-edit-card *ngIf="isEditing" [task]="task" [contacts]="contacts" (close)="closeEdit()"
    (updated)="onTaskUpdated($event)">
  </app-edit-card>

</div>