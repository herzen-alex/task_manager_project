<div class="task-card" [class.done]="task.done" [ngClass]="task.priority">

  <h3>{{ task.title }}</h3>
  <p>{{ task.description }}</p>

  <!-- ğŸ“… Datum -->
  <small>ğŸ•’ Created: {{ task.createdAt | date:'dd/MM/yyyy' }}</small><br />
  <small *ngIf="task.dueDate">â° Due: {{ task.dueDate | date:'dd/MM/yyyy' }}</small>

  <!-- ğŸ“Š Fortschritt -->
  <div *ngIf="task.subTasks?.length" class="progress-wrapper">
    <small>Progress: {{ progress }}%</small>
    <progress [value]="progress" max="100"></progress>
  </div>

  <!-- âœ… Subtasks -->
  <ul *ngIf="task.subTasks?.length" class="subtask-list" [class.locked]="task.done">
    <li *ngFor="let sub of task.subTasks; let i = index">
      <input type="checkbox" [(ngModel)]="sub.done" (change)="updateProgress()" [disabled]="task.done" />

      <span [class.done]="sub.done">{{ sub.title }}</span>

      <button class="delete-subtask" (click)="deleteSubTask(i)" [disabled]="task.done" title="Delete subtask">
        âœ–
      </button>
    </li>

  </ul>

  <!-- â• Subtask hinzufÃ¼gen -->
  <div class="subtask-input" [class.locked]="task.done">
    <input [(ngModel)]="newSubTaskTitle" placeholder="New subtask" [disabled]="task.done" />
    <button (click)="addSubTask()" [disabled]="task.done">+</button>
  </div>

  <div class="actions">
    <div class="done-wrapper">
      
      <button (click)="toggleDone.emit(task)" [disabled]="!canMarkDone">
        {{ task.done ? 'Undo' : 'Done' }}
      </button>

      <div class="tooltip" *ngIf="!canMarkDone" role="tooltip" aria-live="polite">
        Complete all subtasks first
      </div>
    </div>

    <button (click)="delete.emit(task)">Delete</button>
  </div>
</div>